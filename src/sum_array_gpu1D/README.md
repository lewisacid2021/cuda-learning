
---

# âœ… 1D kernelçš„é—®é¢˜éå¸¸å…³é”®

### **1D kernelï¼šæ¯ä¸ª thread åªè´Ÿè´£ä¸€ä¸ª ixï¼Œä½†éå†äº†æ‰€æœ‰ iy**

```cpp
__global__ void sumArrayOnGPU1D(float *A, float *B, float *C, int nx, int ny) {
    unsigned int ix = blockIdx.x * blockDim.x + threadIdx.x;
    if(ix<nx){
        for(int iy=0; iy<ny; iy++){
            int idx = iy * nx + ix;
            C[idx] = A[idx] + B[idx];
        }
    }
}
```

## â— æœ¬è´¨ï¼š**åªåœ¨ x æ–¹å‘å¹¶è¡Œï¼Œy æ–¹å‘ä¸²è¡Œ**

ä¾‹å­ï¼š

* nx = 8192
* ny = 8192

åˆ™çº¿ç¨‹æ€»æ•°ï¼š

```
grid.x * block.x â‰ˆ nx = 8192
```

ğŸ‘‰ **æ€»å…±åªæœ‰ 8192 ä¸ªçº¿ç¨‹**

è€Œ 2D kernel ä¼šåˆ›å»ºï¼š

```
8192 Ã— 8192 = 67,108,864 ä¸ªçº¿ç¨‹
```

ğŸ‘‰ **å¹¶è¡Œåº¦å·®äº† 8000 å€ï¼ï¼ï¼**

## ğŸ”¥ 1D çš„å·¨å¤§ç“¶é¢ˆ

æ¯ä¸ªçº¿ç¨‹å¿…é¡»æ‰§è¡Œï¼š

* **ny æ¬¡è¿­ä»£**
* **ny æ¬¡ å…¨å±€å†…å­˜åŠ è½½**
* **ny æ¬¡ å…¨å±€å†…å­˜å†™å›**

ä¾‹å¦‚ ny = 8192ï¼š

```
æ¯ä¸ª thread åš 8192 æ¬¡ A[idx], B[idx], C[idx]
```

è®© GPU çš„æ¯ä¸ª thread åš 8000+ æ¬¡ DRAM åŠ è½½ â†’ æåº¦æµªè´¹ GPU å¹¶è¡Œèƒ½åŠ›ã€‚

---

# âœ… 2D kernelï¼šå®Œç¾æ˜ å°„äºŒç»´æ•°æ®ç»“æ„

ä½ çš„ 2D ç‰ˆæœ¬ï¼š

```cpp
__global__ void sumArrayOnGPU2D(float *A, float *B, float *C, int nx, int ny) {
    int ix = blockIdx.x * blockDim.x + threadIdx.x;
    int iy = blockIdx.y * blockDim.y + threadIdx.y;

    if (ix < nx && iy < ny) {
        int idx = iy * nx + ix;
        C[idx] = A[idx] + B[idx];
    }
}
```

## æœ¬è´¨ï¼š**x å’Œ y å…¨éƒ¨å¹¶è¡Œ**

æ¯ä¸ª thread åªè´Ÿè´£ä¸€ä¸ªå…ƒç´ ï¼š

```
C[iy][ix] = A[iy][ix] + B[iy][ix]
```

### å¹¶è¡Œåº¦ = nx Ã— ny

å¯¹äº 8192Ã—8192ï¼š

âœ” **6.7e7 ä¸ªçº¿ç¨‹å…¨éƒ¨å¹¶è¡Œæ‰§è¡Œ**
âœ” æ¯ä¸ªçº¿ç¨‹è®¿é—® **ä¸€æ¬¡ A/B/C**
âœ” å®Œç¾æ˜ å°„ GPU çš„ SIMD ç»“æ„

---

# ğŸ† æ€§èƒ½å·®å¼‚çš„æ ¸å¿ƒç»“è®º

| é¡¹ç›®     | 1D kernel                      | 2D kernel                                |
| ------ | ------------------------------ | ---------------------------------------- |
| å¹¶è¡Œåº¦    | **nx**ï¼ˆåªæœ‰ä¸€è¡Œï¼‰                   | **nx Ã— ny**ï¼ˆå…¨çŸ©é˜µï¼‰                         |
| å…¨å±€å†…å­˜è®¿é—® | æ¯ä¸ª thread è¯»å†™ ny æ¬¡              | æ¯ä¸ª thread è¯»å†™ä¸€æ¬¡                           |
| æ€»è®¿é—®é‡   | **nx Ã— ny Ã— 2 loads + stores** | **nx Ã— ny Ã— 2 loads + stores**ï¼ˆä½†åˆ†æ‘Šåˆ°æ›´å¤šçº¿ç¨‹ï¼‰ |
| å•çº¿ç¨‹å·¥ä½œé‡ | éå¸¸å¤§ï¼ˆè¿­ä»£ ny æ¬¡ï¼‰                   | éå¸¸å°ï¼ˆåªåš 1 æ¬¡åŠ æ³•ï¼‰                            |
| ååèƒ½åŠ›   | å—åˆ¶äº thread æ•°å°‘ï¼ŒSM å‘æŒ¥ä¸èµ·æ¥         | æ»¡å  GPUï¼Œååå……åˆ†å‘æŒ¥                            |
| æ€§èƒ½     | âŒ æå·®ï¼ŒCPU å¼å†™æ³•                   | âœ… æ­£å¸¸ GPU kernel å†™æ³•                       |

---

